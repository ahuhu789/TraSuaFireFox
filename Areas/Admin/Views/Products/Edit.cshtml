@model TraSuaFireFox.Models.Sanpham

@{
    ViewData["Title"] = "Chỉnh sửa: " + Model.Tensp;
}

<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-amber-600 flex items-center gap-2">
            <i class="fa-solid fa-pen-to-square"></i> Chỉnh Sửa Sản Phẩm
        </h2>
    </div>

    <form action="@Url.Action("Edit", "Products", new { area = "Admin", id = Model.Masp })" enctype="multipart/form-data" method="post">

        @Html.AntiForgeryToken()

        <input type="hidden" name="Masp" value="@Model.Masp" />

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div class="space-y-4">
                <div>
                    <label for="Tensp" class="block text-sm font-medium text-gray-700">Tên Món</label>
                    <input type="text" id="Tensp" name="Tensp" value="@Model.Tensp" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2" />
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="Dongia" class="block text-sm font-medium text-gray-700">Đơn giá</label>
                        <input type="number" id="Dongia" name="Dongia" value="@Model.Dongia" step="any" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2" />
                    </div>
                    <div>
                        <label for="Soluongton" class="block text-sm font-medium text-gray-700">Số lượng tồn</label>
                        <input type="number" id="Soluongton" name="Soluongton" value="@Model.Soluongton" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2" />
                    </div>
                </div>

                <div>
                    <label for="Trangthai" class="block text-sm font-medium text-gray-700">Trạng thái</label>
                    <select id="Trangthai" name="Trangthai" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">
                        <!option value="Còn hàng" @(Model.Trangthai == "Còn hàng" ? "selected" : "")>Còn hàng</!option>
                        <!option value="Hết hàng" @(Model.Trangthai == "Hết hàng" ? "selected" : "")>Hết hàng</!option>
                        <!option value="Ngừng bán" @(Model.Trangthai == "Ngừng bán" ? "selected" : "")>Ngừng bán</!option>
                    </select>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="Madm" class="block text-sm font-medium text-gray-700">Danh mục</label>
                    <select id="Madm" name="Madm" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">
                        <option value="">-- Chọn Danh Mục --</option>
                        @if (ViewBag.DsDanhmuc != null)
                        {
                            foreach (var item in (IEnumerable<TraSuaFireFox.Models.Danhmuc>)ViewBag.DsDanhmuc)
                            {
                                var isSelected = Model.Madm == item.Madm ? "selected" : "";
                                <!option value="@item.Madm" @isSelected>@item.Tendm</!option>
                            }
                        }
                    </select>
                </div>

                <div>
                    <label for="Mancc" class="block text-sm font-medium text-gray-700">Nhà cung cấp</label>
                    <select id="Mancc" name="Mancc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">
                        <option value="">-- Chọn Nhà Cung Cấp --</option>
                        @if (ViewBag.DsNhacungcap != null)
                        {
                            foreach (var item in (IEnumerable<TraSuaFireFox.Models.Nhacungcap>)ViewBag.DsNhacungcap)
                            {
                                var isSelected = Model.Mancc == item.Mancc ? "selected" : "";
                                <!option value="@item.Mancc" @isSelected>@item.Tenncc</!option>
                            }
                        }
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Hình ảnh</label>

                    <div class="flex items-start gap-4">
                        <div class="w-24 h-24 border rounded-lg overflow-hidden flex-shrink-0 relative">
                            @{
                                string imgPath = string.IsNullOrEmpty(Model.Hinhanh) ? "default.jpg" : Model.Hinhanh;
                            }
                            <img id="image-preview" src="~/images/products/@imgPath" class="w-full h-full object-cover" alt="Ảnh sản phẩm" />
                        </div>

                        <div class="flex-1">
                            <label for="HinhAnhUpload" class="cursor-pointer bg-amber-50 border border-amber-300 text-amber-700 px-4 py-2 rounded-md hover:bg-amber-100 transition inline-block font-medium text-sm">
                                <i class="fa-solid fa-camera mr-1"></i> Chọn ảnh mới
                            </label>
                            <input id="HinhAnhUpload" name="HinhAnhUpload" type="file" class="hidden" accept="image/*" onchange="previewImage(this)" />
                            <p class="text-xs text-gray-500 mt-2">Để trống nếu muốn giữ ảnh cũ.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6">
            <label for="Mota" class="block text-sm font-medium text-gray-700">Mô tả chi tiết</label>
            <textarea id="Mota" name="Mota" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">@Model.Mota</textarea>
        </div>

        <div class="mt-8 flex justify-end gap-3">
            <a href="@Url.Action("Index")" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition">Hủy bỏ</a>
            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition shadow-lg font-bold">
                <i class="fa-solid fa-floppy-disk mr-1"></i> Cập nhật
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function previewImage(input) {
            const preview = document.getElementById('image-preview');
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result; // Thay đổi src của thẻ img hiện có
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}