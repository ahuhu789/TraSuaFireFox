@model TraSuaFireFox.Models.Sanpham

@{
    ViewData["Title"] = "Thêm Món Mới";
}

<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">
    <h2 class="text-2xl font-bold text-amber-600 mb-6 flex items-center gap-2">
        <i class="fa-solid fa-circle-plus"></i> Thêm Món Trà Sữa Mới
    </h2>

    <form action="@Url.Action("Create", "Products", new { area = "Admin" })" enctype="multipart/form-data" method="post">

        @Html.AntiForgeryToken()

        @if (!ViewData.ModelState.IsValid)
        {
            <div class="mb-4 text-red-500 text-sm text-center font-medium border border-red-200 bg-red-50 p-2 rounded">
                @Html.ValidationSummary(false)
            </div>
        }

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div>
                    <label for="Masp" class="block text-sm font-medium text-gray-700">Mã Sản Phẩm</label>
                    <input type="text"
                           id="Masp"
                           name="Masp"
                           value="@Model?.Masp"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2"
                           placeholder="VD: SP0100"
                           required />
                    @if (ViewData.ModelState["Masp"]?.Errors.Count > 0)
                    {
                        <span class="text-red-500 text-xs">@ViewData.ModelState["Masp"]?.Errors[0].ErrorMessage</span>
                    }
                </div>

                <div>
                    <label for="Tensp" class="block text-sm font-medium text-gray-700">Tên Món</label>
                    <input type="text"
                           id="Tensp"
                           name="Tensp"
                           value="@Model?.Tensp"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2"
                           placeholder="VD: Trà Sữa Trân Châu" />
                    @if (ViewData.ModelState["Tensp"]?.Errors.Count > 0)
                    {
                        <span class="text-red-500 text-xs">@ViewData.ModelState["Tensp"]?.Errors[0].ErrorMessage</span>
                    }
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="Dongia" class="block text-sm font-medium text-gray-700">Đơn giá</label>
                        <input type="number"
                               id="Dongia"
                               name="Dongia"
                               value="@Model?.Dongia"
                               step="any"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2" />
                    </div>
                    <div>
                        <label for="Soluongton" class="block text-sm font-medium text-gray-700">Số lượng tồn</label>
                        <input type="number"
                               id="Soluongton"
                               name="Soluongton"
                               value="@Model?.Soluongton"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2" />
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="Madm" class="block text-sm font-medium text-gray-700">Danh mục</label>
                    <select id="Madm" name="Madm" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">
                        <option value="">-- Chọn Danh Mục --</option>
                        @if (ViewBag.DsDanhmuc != null)
                        {
                            foreach (var item in (IEnumerable<TraSuaFireFox.Models.Danhmuc>)ViewBag.DsDanhmuc)
                            {
                                // Logic kiểm tra selected thủ công
                                var isSelected = Model?.Madm == item.Madm ? "selected" : "";
                                <!option value="@item.Madm" @isSelected>@item.Tendm</!option>
                            }
                        }
                    </select>
                    @if (ViewData.ModelState["Madm"]?.Errors.Count > 0)
                    {
                        <span class="text-red-500 text-xs">@ViewData.ModelState["Madm"]?.Errors[0].ErrorMessage</span>
                    }
                </div>

                <div>
                    <label for="Mancc" class="block text-sm font-medium text-gray-700">Nhà cung cấp</label>
                    <select id="Mancc" name="Mancc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">
                        <option value="">-- Chọn Nhà Cung Cấp --</option>
                        @if (ViewBag.DsNhacungcap != null)
                        {
                            foreach (var item in (IEnumerable<TraSuaFireFox.Models.Nhacungcap>)ViewBag.DsNhacungcap)
                            {
                                var isSelected = Model?.Mancc == item.Mancc ? "selected" : "";
                                <!option value="@item.Mancc" @isSelected>@item.Tenncc</!option>
                            }
                        }
                    </select>
                    @if (ViewData.ModelState["Mancc"]?.Errors.Count > 0)
                    {
                        <span class="text-red-500 text-xs">@ViewData.ModelState["Mancc"]?.Errors[0].ErrorMessage</span>
                    }
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Hình ảnh sản phẩm</label>
                    <label for="HinhAnhUpload" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 hover:border-amber-500 transition relative overflow-hidden group">
                        <div id="upload-prompt" class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-400 mb-3 group-hover:text-amber-500 transition group-hover:scale-110"></i>
                            <p class="mb-2 text-sm text-gray-500 text-center">
                                <span class="font-semibold text-amber-600">Bấm để chọn ảnh</span> hoặc kéo thả vào đây
                            </p>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF (Tối đa 5MB)</p>
                        </div>
                        <img id="image-preview" class="absolute inset-0 w-full h-full object-contain hidden bg-white p-2" />
                        <input id="HinhAnhUpload" name="HinhAnhUpload" type="file" class="hidden" accept="image/*" onchange="previewImage(this)" />
                    </label>
                </div>
            </div>
        </div>

        <div class="mt-6">
            <label for="Mota" class="block text-sm font-medium text-gray-700">Mô tả chi tiết</label>
            <textarea id="Mota" name="Mota" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 border p-2">@Model?.Mota</textarea>
        </div>

        <input type="hidden" id="Trangthai" name="Trangthai" value="Còn hàng" />

        <div class="mt-8 flex justify-end gap-3">
            <a href="@Url.Action("Index")" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition">Hủy bỏ</a>
            <button type="submit" class="bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition shadow-lg font-bold">
                <i class="fa-solid fa-save mr-1"></i> Lưu Sản Phẩm
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function previewImage(input) {
            const preview = document.getElementById('image-preview');
            const prompt = document.getElementById('upload-prompt');

            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    prompt.classList.add('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = '#';
                preview.classList.add('hidden');
                prompt.classList.remove('hidden');
            }
        }
    </script>
}